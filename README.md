# WebGL2 Ray Tracer (SAH BVH + glTF)

This is a minimal WebGL2 ray tracer that builds a SAH BVH on the CPU, flattens it into a linear array, uploads everything into floating point textures, and performs traversal + triangle intersection in a fragment shader with accumulation.

## Features
- CPU SAH BVH build (flattened BVH layout)
- BVH + triangle data packed into RGBA32F textures
- glTF 2.0/1.0 loader for embedded or external buffers
- glTF base colors and vertex colors (COLOR_0) baked per triangle
- Fragment shader traversal with a fixed-size stack and accumulation
- Path tracing with directional lights (next-event estimation) and HDR environment lighting

## Run
Serve the directory with uvicorn (reload enabled):

```
mamba run -n wave uvicorn server:app --reload
```

Requires `uvicorn` installed in the `wave` environment.

Then open `http://localhost:8000`.

## Example assets
Generate the embedded-buffer `.gltf` examples:

```
python tools/generate_examples.py
```

Download HDR environment maps:

```
python tools/download_envs.py
```

## Assets and licenses
- `assets/triangle.gltf`, `assets/cube.gltf`, `assets/overlap_boxes.gltf` are generated by `tools/generate_examples.py` and are original to this repo.
- `assets/Duck.gltf` is from the Khronos glTF Sample Models repository and is licensed under the SCEA Shared Source License, Version 1.0. citeturn0search13
- HDR environment maps (`assets/env/studio_small_01_1k.hdr`, `assets/env/kloofendal_overcast_1k.hdr`) are from Poly Haven and are CC0 (public domain). citeturn0search6

## Tests
```
npm test
```

## Notes
- The loader supports embedded `data:` buffers and external buffers when the glTF is served over HTTP.
- If you upload a local `.gltf` file with external buffers, it will fail (no path access from the browser).
- Material and lighting controls are in the left panel (base color, metallic, roughness, max bounces, exposure, samples per pixel, ray bias/tMin).
- Environment maps live under `assets/env` and are loaded at runtime via HDR parsing.
- Controls: drag to orbit, mouse wheel to zoom, WASDQE to pan while rendering.
- Autorun: append `?autorun=1` to start rendering automatically, and `&example=assets/cube.gltf` to pick the example.
- If you hit GPU memory errors, lower the render scale in the UI.
- Traversal mode: switch between BVH and brute force in the UI (debugging).
